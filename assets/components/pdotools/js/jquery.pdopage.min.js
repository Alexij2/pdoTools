!function(a,b,c,d){"use strict";function e(c,d){this.element=c,this.settings=a.extend({},g,d),this._defaults=g,this._name=f,this.key=this.settings.pageVarKey,this.wrapper=a(this.settings.wrapper),this.mode=this.settings.mode,this.reached=!1,this.history=this.settings.history,this.oldBrowser=!(b.history&&history.pushState),this.init()}var f="pdoPage",g={wrapper:"#pdopage",rows:"#pdopage .row",pagination:"#pdopage .pagination",link:"#pdopage .pagination a",more:"#pdopage .btn-more",pdoTitle:"#pdopage .title",moreTpl:'<button class="btn btn-default btn-more">Load more</button>',waitAnimation:'<div class="wait-wrapper"><div class="wait"></div></div>',mode:"scroll",pageVarKey:"page",pageLimit:12,assetsUrl:"/assets/components/pdotools/"};a.extend(e.prototype,{init:function(){var b=this;if(b.page==d){var c=b.hashGet(),e=c[b.key]==d?1:c[b.key];b.page=Number(e)}switch(b.mode){case"default":this.initDefault();break;case"scroll":case"button":if(b.history){if("undefined"==typeof jQuery().sticky)return void a.getScript(b.settings.assetsUrl+"js/lib/jquery.sticky.min.js",function(){b.init(b.settings)});b.stickyPagination()}else a(b.settings.pagination).hide();"button"==b.mode?this.initButton():this.initScroll()}},initDefault:function(){var d=this;a(c).on("click",d.settings.link,function(b){b.preventDefault();var c=a(this).prop("href"),e=c.match(new RegExp(d.key+"=(\\d+)")),f=e?e[1]:1;d.page!=f&&(d.history&&d.hashAdd(d.key,f),d.loadPage(c))}),d.history&&(a(b).on("popstate",function(a){a.originalEvent.state&&a.originalEvent.state.pdoPage&&d.loadPage(a.originalEvent.state.pdoPage)}),history.replaceState({pdoPage:b.location.href},""))},initButton:function(){var b=this;a(b.settings.rows).after(b.settings.moreTpl);var d=!1;a(b.settings.link).each(function(){var c=a(this).prop("href"),e=c.match(new RegExp(b.key+"=(\\d+)")),f=e?e[1]:1;if(f>b.page)return d=!0,!1}),d||a(b.settings.more).hide(),a(c).on("click",b.settings.more,function(a){a.preventDefault(),b.addPage()})},initScroll:function(){var c=this,d=a(b);d.on("scroll",function(){!c.reached&&d.scrollTop()>c.wrapper.height()-d.height()&&(c.reached=!0,c.addPage())})},addPage:function(){var b=this,c=b.hashGet(),d=c[b.key]||1;a(b.settings.link).each(function(){var c=a(this).prop("href"),e=c.match(new RegExp(b.key+"=(\\d+)")),f=e?Number(e[1]):1;if(f>d)return b.history&&b.hashAdd(b.key,f),b.page=d,b.loadPage(c,"append"),!1})},loadPage:function(c,d){var e=this,f=a(e.settings.rows),g=a(e.settings.pagination),h=c.match(new RegExp(e.key+"=(\\d+)")),i=h?Number(h[1]):1;if(d||(d="replace"),e.page!=i||"force"==d){e.wrapper.trigger("beforeLoad",[e,e.settings]),"scroll"!=e.mode&&e.wrapper.css({opacity:.3});var j=e.hashGet();for(var k in j)j.hasOwnProperty(k)&&k!=e.key&&delete j[k];j[e.key]=e.page=i;var l=a(e.settings.waitAnimation);"append"==d?e.wrapper.find(f).append(l):e.wrapper.find(f).empty().append(l),"force"==d&&(j=e.getUrlParameters(c),j[e.key]=j[e.key]||1),a.get(b.location.pathname,j,function(b){b&&(e.wrapper.find(g).html(b.pagination),"append"==d?(e.wrapper.find(f).append(b.output),"button"==e.mode?b.pages==b.page?a(e.settings.more).hide():a(e.settings.more).show():"scroll"==e.mode&&(e.reached=!1),l.remove()):e.wrapper.find(f).html(b.output),e.wrapper.trigger("afterLoad",[e,e.settings,b]),"scroll"!=e.mode&&(e.wrapper.css({opacity:1}),"default"==e.mode&&a("html, body").animate({scrollTop:e.wrapper.position().top-50||0},0)),e.updateTitle(b))},"json")}},stickyPagination:function(){var b=this,c=a(b.settings.pagination);c.is(":visible")&&(c.sticky({wrapperClassName:"sticky-pagination",getWidthFrom:b.settings.pagination,responsiveWidth:!0}),b.wrapper.trigger("scroll"))},updateTitle:function(b){if("undefined"!=typeof pdoTitle){for(var c=a("title"),d=pdoTitle.separator||" / ",e=pdoTitle.tpl,f=[],g=c.text().split(d),h=new RegExp("^"+e.split(" ")[0]+" "),i=0;i<g.length;i++)1===i&&b.page&&b.page>1&&f.push(e.replace("{page}",b.page).replace("{pageCount}",b.pages)),g[i].match(h)||f.push(g[i]);c.text(f.join(d))}},getUrlParameters:function(a){var b={},c=a.indexOf("?");return c!==-1&&(b=this.deparam(a.substring(c+1))),b},deparam:function(a){var b=/^\d+$/,c=/([^\[\]]+)|(\[\])/g,d=/\+/g,e=/([^?#]*)(#.*)?$/;if(!a||!e.test(a))return{};for(var f,g={},h=a.split("&"),i=0;i<h.length;i++){f=g;var j=h[i].split("=");2!=j.length&&(j=[j[0],j.slice(1).join("=")]);for(var k=decodeURIComponent(j[0].replace(d," ")),l=decodeURIComponent(j[1].replace(d," ")),m=k.match(c),n=0;n<m.length-1;n++){var o=m[n];f[o]||(f[o]=b.test(m[n+1])||"[]"==m[n+1]?[]:{}),f=f[o]}var p=m[m.length-1];"[]"==p?f.push(l):f[p]=l}return g},hashGet:function(){var a,c,d,e={};if(this.oldBrowser)d=decodeURIComponent(b.location.hash.substr(1)),c="/";else{var f=b.location.href.indexOf("?");d=f!=-1?decodeURIComponent(b.location.href.substr(f+1)):"",c="&"}if(0==d.length)return e;d=d.split(c);for(var g in d)d.hasOwnProperty(g)&&(a=d[g].split("="),"undefined"==typeof a[1]?e.anchor=a[0]:e[a[0]]=a[1]);return e},hashSet:function(a){var c="";for(var d in a)if(a.hasOwnProperty(d))if("string"==typeof a[d])c+="&"+d+"="+a[d];else for(var e in a[d])a[d].hasOwnProperty(e)&&(c+="&"+d+"="+a[d][e]);this.oldBrowser?b.location.hash=c.substr(1):(0!=c.length&&(c="?"+c.substr(1)),b.history.pushState({pdoPage:b.location.pathname+c},"",b.location.pathname+c))},hashAdd:function(a,b){var c=this.hashGet();c[a]=b,this.hashSet(c)},hashRemove:function(a){var b=this.hashGet();delete b[a],this.hashSet(b)},hashClear:function(){this.hashSet({})}}),a.fn[f]=function(b){var c=arguments;if(b===d||"object"==typeof b)return this.each(function(){a.data(this,"plugin_"+f)||a.data(this,"plugin_"+f,new e(this,b))});if("string"==typeof b&&"_"!==b[0]&&"init"!==b){var g;return this.each(function(){var d=a.data(this,"plugin_"+f);d instanceof e&&"function"==typeof d[b]&&(g=d[b].apply(d,Array.prototype.slice.call(c,1))),"destroy"===b&&a.data(this,"plugin_"+f,null)}),g!==d?g:this}}}(jQuery,window,document);